name: 'Dockerize'
description: 'Create and upload a Docker image to our hub'

inputs:
  stage:
    description: "Stage used inside of the image"
    required: true

  app:
    description: "Which app build"
    required: true

runs:
  using: composite
  steps:
    - name: Restore App
      uses: actions/cache/restore@v3
      with:
        fail-on-cache-miss: true
        key: ${{ runner.OS }}-${{ github.sha }}-${{ inputs.stage }}-app
        path: './app/${{ inputs.app }}'

    - name: Tap
      shell: bash
      run: ls -pal app/${{ inputs.app }}

    - name: Build docker image
      uses: common-platform/actions/build-image@v0
      with:
        dockerfile-path: ./app/${{ inputs.app }}/Dockerfile
        push-image: true
        additional-tags: '["${{ github.sha }}"]'
        build-args: '{"STAGE": "${{ inputs.stage }}", "APPLICATION": "${{ inputs.app }}", "CDN": "https://scm-milanuncios-frontend-pre.milanuncios.net/pet/${{ inputs.stage }}/"}'
        suffix: '${{ inputs.app }}-${{ inputs.stage }}'
