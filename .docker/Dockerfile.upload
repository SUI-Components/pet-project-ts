ARG BASE_IMG

FROM ${BASE_IMG} as base

FROM amazon/aws-cli

ARG AWS_ACCESS_KEY_ID
ARG AWS_SECRET_ACCESS_KEY
ARG AWS_SESSION_TOKEN
ARG STAGE

ENV AWS_ACCESS_KEY_ID $AWS_ACCESS_KEY_ID
ENV AWS_SECRET_ACCESS_KEY $AWS_SECRET_ACCESS_KEY
ENV AWS_SESSION_TOKEN $AWS_SESSION_TOKEN
ENV STAGE $STAGE

WORKDIR /usr/src/app

COPY --from=base /usr/src/app .
COPY .docker/scripts/aws_upload.sh .

ENTRYPOINT make cdn
